<Window x:Class="TA_WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TA_WPF"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:viewmodels="clr-namespace:TA_WPF.ViewModels"
        xmlns:converters="clr-namespace:TA_WPF.Converters"
        xmlns:views="clr-namespace:TA_WPF.Views"
        mc:Ignorable="d"
        d:DesignHeight="700" d:DesignWidth="1200"
        Title="车票管理系统" Height="700" Width="1200"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="{DynamicResource MaterialDesignFontSize}"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="Microsoft YaHei"
        StateChanged="Window_StateChanged"
        Loaded="MainWindow_Loaded"
        materialDesign:ThemeAssist.Theme="{Binding IsDarkMode, Converter={StaticResource BooleanToThemeConverter}}">
    
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/DesignTimeResources.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.Defaults.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <converters:BooleanToThemeConverter x:Key="BooleanToThemeConverter" />
        </ResourceDictionary>
    </Window.Resources>
    
    <materialDesign:DialogHost Identifier="RootDialog">
    <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 标题栏 -->
            <materialDesign:ColorZone Mode="PrimaryMid" Padding="16" Grid.Row="0">
                <DockPanel>
                    <ToggleButton x:Name="MenuToggleButton"
                                Style="{StaticResource MaterialDesignHamburgerToggleButton}"
                                DockPanel.Dock="Left"
                                IsChecked="False"
                                AutomationProperties.Name="HamburgerToggleButton"/>
                    <TextBlock Text="车票管理系统" 
                            VerticalAlignment="Center" 
                            HorizontalAlignment="Center" 
                            FontSize="22" 
                            FontWeight="Bold"/>
                </DockPanel>
            </materialDesign:ColorZone>

            <!-- 主内容区域 -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- 侧边栏 -->
                <materialDesign:DrawerHost Grid.Column="0" 
                                        IsLeftDrawerOpen="{Binding ElementName=MenuToggleButton, Path=IsChecked}"
                                        LeftDrawerBackground="{DynamicResource MaterialDesignPaper}">
                    <materialDesign:DrawerHost.LeftDrawerContent>
                        <DockPanel MinWidth="220">
                            <materialDesign:ColorZone Mode="PrimaryMid" 
                                                    Padding="16" 
                                                    DockPanel.Dock="Top">
                                <TextBlock Text="菜单" 
                                        FontSize="18" 
                                        FontWeight="Bold" 
                                        HorizontalAlignment="Center"/>
                            </materialDesign:ColorZone>
                            <TreeView Margin="0,16,0,16">
                                <TreeViewItem>
                                    <TreeViewItem.Header>
                                        <Button Content="首页" 
                                                Command="{Binding ShowHomeCommand}" 
                                                Style="{StaticResource MaterialDesignFlatButton}"
                                                HorizontalContentAlignment="Left"
                                                Width="200"
                                                Margin="0"
                                                Foreground="{DynamicResource PrimaryHueMidBrush}">
                                            <Button.ContentTemplate>
                                                <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="Home" Margin="0,0,8,0"/>
                                                        <TextBlock Text="{Binding}" />
                                        </StackPanel>
                                                </DataTemplate>
                                            </Button.ContentTemplate>
                                        </Button>
                                    </TreeViewItem.Header>
                                </TreeViewItem>
                                <TreeViewItem IsExpanded="True">
                                    <TreeViewItem.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="Train" Margin="0,0,8,0"/>
                                            <TextBlock Text="车票管理"/>
                                        </StackPanel>
                                    </TreeViewItem.Header>
                                    <TreeViewItem>
                                        <TreeViewItem.Header>
                                            <Button Content="添加车票" 
                                                    Command="{Binding TicketViewModel.AddTicketCommand}" 
                                                    Style="{StaticResource MaterialDesignFlatButton}"
                                                    HorizontalContentAlignment="Left"
                                                    Width="200"
                                                    Margin="0"
                                                    Foreground="{DynamicResource PrimaryHueMidBrush}">
                                                <Button.ContentTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <materialDesign:PackIcon Kind="TrainCar" Margin="0,0,8,0"/>
                                                            <TextBlock Text="{Binding}" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Button.ContentTemplate>
                                            </Button>
                                        </TreeViewItem.Header>
                                    </TreeViewItem>
                                </TreeViewItem>
                                <TreeViewItem IsExpanded="True">
                                    <TreeViewItem.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="AccountSearch" Margin="0,0,8,0"/>
                                            <TextBlock Text="查询"/>
                                        </StackPanel>
                                    </TreeViewItem.Header>
                                    <TreeViewItem>
                                        <TreeViewItem.Header>
                                            <Button Content="查询全部" 
                                                    Command="{Binding QueryAllCommand}" 
                                                    Style="{StaticResource MaterialDesignFlatButton}"
                                                    HorizontalContentAlignment="Left"
                                                    Width="200"
                                                    Margin="0"
                                                    Foreground="{DynamicResource PrimaryHueMidBrush}">
                                                <Button.ContentTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <materialDesign:PackIcon Kind="DatabaseSearch" Margin="0,0,8,0"/>
                                                            <TextBlock Text="{Binding}" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Button.ContentTemplate>
                                            </Button>
                                        </TreeViewItem.Header>
                                    </TreeViewItem>
                                </TreeViewItem>
                                <TreeViewItem>
                                    <TreeViewItem.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="OfficeBuildingMarker" Margin="0,0,8,0"/>
                                            <TextBlock Text="车站管理"/>
                                        </StackPanel>
                                    </TreeViewItem.Header>
                                </TreeViewItem>
                                <TreeViewItem>
                                    <TreeViewItem.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="ChartBar" Margin="0,0,8,0"/>
                                            <TextBlock Text="统计分析"/>
                                        </StackPanel>
                                    </TreeViewItem.Header>
                                </TreeViewItem>
                                <TreeViewItem>
                                    <TreeViewItem.Header>
                                        <Button x:Name="SettingsButton"
                                                Style="{StaticResource MaterialDesignFlatButton}"
                                                HorizontalContentAlignment="Left"
                                                Width="200"
                                                Margin="0"
                                                Click="SettingsButton_Click"
                                                Foreground="{DynamicResource PrimaryHueMidBrush}">
                                            <Grid Width="200">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <materialDesign:PackIcon Grid.Column="0" Kind="Settings" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="1" Text="系统设置" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Button>
                                    </TreeViewItem.Header>
                                </TreeViewItem>
                            </TreeView>
                        </DockPanel>
                    </materialDesign:DrawerHost.LeftDrawerContent>
                </materialDesign:DrawerHost>

                <!-- 主内容 -->
                <Grid Grid.Column="1">
                    <!-- 欢迎界面 -->
                    <Grid Visibility="{Binding ShowWelcome, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <materialDesign:PackIcon Kind="TrainVariant" Width="100" Height="100" HorizontalAlignment="Center" Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                            <TextBlock Text="欢迎使用车票管理系统" FontSize="24" Margin="0,20,0,10" HorizontalAlignment="Center"/>
                            <TextBlock Text="请使用左侧菜单进行操作" FontSize="16" Margin="0,0,0,20" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Grid>

                    <!-- 查询全部车票页面 -->
                    <views:QueryAllTicketsPage 
                        DataContext="{Binding QueryAllTicketsViewModel}"
                        Visibility="{Binding DataContext.ShowQueryAllTickets, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                    <!-- 设置页面 -->
                    <views:SettingsPage 
                                        x:Name="SettingsPageControl"
                                        Visibility="{Binding ShowSettings, Converter={StaticResource BooleanToVisibilityConverter}}"
                                        DataContext="{Binding}"/>
                </Grid>
            </Grid>
    </Grid>
    </materialDesign:DialogHost>
</Window>
