<Window x:Class="TA_WPF.Views.TicketPreviewWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TA_WPF.Views"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:viewmodels="clr-namespace:TA_WPF.ViewModels"
        xmlns:converters="clr-namespace:TA_WPF.Converters"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        d:DataContext="{d:DesignInstance Type=viewmodels:TicketPreviewViewModel, IsDesignTimeCreatable=True}"
        d:DesignHeight="900" d:DesignWidth="1100"
        mc:Ignorable="d"
        Title="车票预览" 
        Height="650" 
        Width="1100"
        MinHeight="600"
        MinWidth="1000"
        WindowStartupLocation="CenterScreen"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        Background="{DynamicResource MaterialDesignPaper}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        FontFamily="Microsoft YaHei UI">

    <Window.Resources>
        <converters:StationWordPositionConverter x:Key="StationWordPositionConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <converters:MoneyUnitPositionConverter x:Key="MoneyUnitPositionConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:FirstLetterToUpperConverter x:Key="FirstLetterToUpperConverter"/>
        <converters:InverseStringToVisibilityConverter x:Key="InverseStringToVisibilityConverter"/>
        <converters:MoneyValueToMarginConverter x:Key="MoneyValueToMarginConverter"/>
        <converters:TrainNumberPositionConverter x:Key="TrainNumberPositionConverter"/>
        <converters:ArrowStyleConverter x:Key="ArrowStyleConverter"/>
        <converters:PointConverter x:Key="PointConverter"/>
        <converters:ArrowStartPointConverter x:Key="ArrowStartPointConverter"/>
        <converters:HeadStartPointConverter x:Key="HeadStartPointConverter"/>
        <converters:ArrowPathConverter x:Key="ArrowPathConverter"/>
        <converters:StationNameConverter x:Key="StationNameConverter"/>
        <converters:BooleanToThemeConverter x:Key="BooleanToThemeConverter"/>
        <converters:BooleanToVisibilityHiddenConverter x:Key="BooleanToVisibilityHiddenConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <converters:StringEqualityToBooleanConverter x:Key="StringEqualityToBooleanConverter"/>
        <converters:FullScreenWindowStyleConverter x:Key="FullScreenWindowStyleConverter"/>
        <converters:FullScreenWindowStateConverter x:Key="FullScreenWindowStateConverter"/>
        <converters:BooleanToStringConverter x:Key="BooleanToStringConverter"/>
        <converters:FontSizeIncreaseConverter x:Key="FontSizeIncreaseConverter"/>

        <!-- 自定义表单文本块样式 -->
        <Style x:Key="FormLabelStyle" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignCaptionTextBlock}">
            <Setter Property="FontFamily" Value="Microsoft YaHei UI"/>
            <Setter Property="Margin" Value="2,4,2,2"/>
            <Setter Property="FontWeight" Value="Medium"/>
        </Style>

        <!-- 自定义表单文本框样式 -->
        <Style x:Key="FormTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Setter Property="FontFamily" Value="Microsoft YaHei UI"/>
            <Setter Property="IsEnabled" Value="False"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="8,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Margin" Value="2,0,2,8"/>
        </Style>

        <!-- 系统常量 -->
        <sys:Double x:Key="Ten">10</sys:Double>
        <sys:Double x:Key="Twenty">20</sys:Double>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="380" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- 左侧数据表单 -->
        <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto" Margin="0,0,12,0">
            <Grid Margin="2,0,2,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="10" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <!-- 0: 标题 -->
                    <RowDefinition Height="Auto" />
                    <!-- 1: 车票号码/检票口 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 2: 车票号码/检票口 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 3: 出发车站/车次号 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 4: 出发车站/车次号 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 5: 出发站拼音/到达车站 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 6: 出发站拼音/到达车站 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 7: 出发日期/到达站拼音 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 8: 出发日期/到达站拼音 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 9: 车厢号/出发时间 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 10: 车厢号/出发时间 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 11: 金额/座位号 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 12: 金额/座位号 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 13: 附加信息/座位类型 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 14: 附加信息/座位类型 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 15: 车票改签类型/车票用途 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 16: 车票改签类型/车票用途 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 17: 提示 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 18: 提示 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 19: 身份信息 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 20: 身份信息 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 21: 编码区 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 22: 编码区 文本框 -->
                </Grid.RowDefinitions>

                <!-- 标题 - 跨所有列 -->
                <TextBlock Text="车票信息" 
                          Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3"
                          Style="{StaticResource MaterialDesignHeadline6TextBlock}" 
                          Margin="0,0,0,8"
                          FontFamily="Microsoft YaHei UI"/>

                <!-- 第一列 -->
                <!-- 车票号码 -->
                <TextBlock Text="车票号码" Grid.Row="1" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.TicketNumber, Mode=OneWay}" 
                        Grid.Row="2" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 出发车站 -->
                <TextBlock Text="出发车站" Grid.Row="3" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.DepartStation, Mode=OneWay}" 
                        Grid.Row="4" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 出发站拼音 -->
                <TextBlock Text="出发站拼音" Grid.Row="5" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.DepartStationPinyin, Mode=OneWay}" 
                        Grid.Row="6" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 出发日期 -->
                <TextBlock Text="出发日期" Grid.Row="7" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.DepartDate, StringFormat=\{0:yyyy-MM-dd\}, Mode=OneWay}" 
                        Grid.Row="8" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 车厢号 -->
                <TextBlock Text="车厢号" Grid.Row="9" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.CoachNo, Mode=OneWay}" 
                        Grid.Row="10" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 金额 -->
                <TextBlock Text="金额" Grid.Row="11" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.Money, StringFormat=¥\{0:N2\}, Mode=OneWay}" 
                        Grid.Row="12" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 附加信息 -->
                <TextBlock Text="附加信息" Grid.Row="13" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.AdditionalInfo, Mode=OneWay}" 
                        Grid.Row="14" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 车票改签类型 -->
                <TextBlock Text="车票改签类型" Grid.Row="15" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.TicketModificationType, Mode=OneWay}" 
                        Grid.Row="16" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 第二列 -->
                <!-- 检票口 -->
                <TextBlock Text="检票口" Grid.Row="1" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.CheckInLocation, Mode=OneWay}" 
                        Grid.Row="2" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 车次号 -->
                <TextBlock Text="车次号" Grid.Row="3" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.TrainNo, Mode=OneWay}" 
                        Grid.Row="4" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 到达车站 -->
                <TextBlock Text="到达车站" Grid.Row="5" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.ArriveStation, Mode=OneWay}" 
                        Grid.Row="6" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 到达站拼音 -->
                <TextBlock Text="到达站拼音" Grid.Row="7" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.ArriveStationPinyin, Mode=OneWay}" 
                        Grid.Row="8" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 出发时间 -->
                <TextBlock Text="出发时间" Grid.Row="9" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding DepartTimeFormatted, Mode=OneWay}" 
                        Grid.Row="10" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 座位号 -->
                <TextBlock Text="座位号" Grid.Row="11" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.SeatNo, Mode=OneWay}" 
                        Grid.Row="12" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 座位类型 -->
                <TextBlock Text="座位类型" Grid.Row="13" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.SeatType, Mode=OneWay}" 
                        Grid.Row="14" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 车票用途 -->
                <TextBlock Text="车票用途" Grid.Row="15" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.TicketPurpose, Mode=OneWay}" 
                        Grid.Row="16" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 提示 - 跨所有列 -->
                <TextBlock Text="提示信息（虚线框内的文本）" Grid.Row="17" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.Hint, Mode=OneWay}" 
                        Grid.Row="18" Grid.Column="0" Grid.ColumnSpan="3"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 身份信息 - 移到提示和编码之间 -->
                <TextBlock Text="身份信息" Grid.Row="19" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding IdentityInfo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                        Grid.Row="20" Grid.Column="0" Grid.ColumnSpan="3"
                        Style="{StaticResource FormTextBoxStyle}"
                        IsEnabled="True"/>

                <!-- 编码区 - 跨所有列 -->
                <TextBlock Text="编码区" Grid.Row="21" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding EncodingArea, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                        Grid.Row="22" Grid.Column="0" Grid.ColumnSpan="3"
                        Style="{StaticResource FormTextBoxStyle}"
                        IsEnabled="True"/>
            </Grid>
        </ScrollViewer>

        <!-- 右侧车票预览 -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 车票预览区域 -->
            <Grid Grid.Row="0">
                <Viewbox Stretch="Uniform" Margin="5">
                    <Grid x:Name="PreviewGrid" Width="811" Height="509">
                        <Image Source="pack://application:,,,/Assets/pic/blueTicket.png" Stretch="Fill" />

                        <!-- 车票号码 -->
                        <TextBlock Text="{Binding SelectedTicket.TicketNumber}" 
                                FontWeight="Normal" 
                                Foreground="Red" 
                                FontSize="40" 
                                Margin="55,20,0,0" 
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top"/>
                        <!-- 检票口 - 条件显示 -->
                        <StackPanel Orientation="Horizontal" 
                        Margin="510,20,0,0" 
                        HorizontalAlignment="Left" 
                        VerticalAlignment="Top">
                            <TextBlock Text="检票：" 
                            FontWeight="Bold" 
                            Foreground="Black"
                            FontFamily="SimHei"
                            FontSize="28">
                                <TextBlock.Style>
                                    <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="{x:Null}">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="Null">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="null">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="NULL">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Text="{Binding SelectedTicket.CheckInLocation}" 
                                        FontWeight="Bold"
                                       FontFamily="SimHei"
                                        Foreground="Black" 
                                        FontSize="28">
                                <TextBlock.Style>
                                    <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="{x:Null}">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="Null">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="null">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="NULL">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                        <!-- 出发站站名 -->
                        <TextBlock Text="{Binding DepartStationWithSpacing}" 
                                FontWeight="Bold"
                                FontFamily="SimHei" 
                                Foreground="Black" 
                                FontSize="40" 
                                Margin="60,60,0,0"
                                Width="280"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top" />

                        <!-- 出发站拼音 -->
                        <TextBlock Text="{Binding SelectedTicket.DepartStationPinyin, Converter={StaticResource FirstLetterToUpperConverter}}" 
                                FontWeight="Normal" 
                                Foreground="Black"
                                FontFamily="Times New Roman"
                                FontSize="28" 
                                Margin="-10,105,0,0"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top">
                            <TextBlock.RenderTransform>
                                <TranslateTransform X="{Binding DepartStationPinyinPosition}"/>
                            </TextBlock.RenderTransform>
                        </TextBlock>

                        <!-- 出发站"站"字 -->
                        <TextBlock Text="站" 
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="30"
                                Width="40"
                                Height="40"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top">
                            <TextBlock.Margin>
                                <MultiBinding Converter="{StaticResource StationWordPositionConverter}">
                                    <Binding Path="DepartStationName"/>
                                    <Binding Source="271,114,513,362"/>
                                </MultiBinding>
                            </TextBlock.Margin>
                        </TextBlock>

                        <!-- 车次号 -->
                        <TextBlock x:Name="TrainNumber"
                                Text="{Binding SelectedTicket.TrainNo}" 
                                FontWeight="Regular" 
                                Foreground="Black" 
                                FontSize="36"
                                FontFamily="Times New Roman"
                                VerticalAlignment="Top"
                                HorizontalAlignment="Left">
                            <TextBlock.Margin>356,60,0,0</TextBlock.Margin>
                        </TextBlock>

                        <!-- 车次号下方箭头 -->
                        <Path Stroke="Black" 
                              StrokeThickness="2.5"
                              HorizontalAlignment="Left"
                              VerticalAlignment="Top"
                              Height="9"
                              Margin="0,100,0,0"
                              RenderTransformOrigin="0,0">
                            <Path.RenderTransform>
                                <TranslateTransform X="{Binding Margin.Left, ElementName=TrainNumber}"/>
                            </Path.RenderTransform>
                            <Path.Data>
                                <MultiBinding Converter="{StaticResource ArrowPathConverter}">
                                    <Binding Path="ActualWidth" ElementName="TrainNumber"/>
                                    <Binding Path="SelectedTicket.TrainNo"/>
                                    <Binding Path="TrainNumberCenterPosition"/>
                                </MultiBinding>
                            </Path.Data>
                        </Path>

                        <!-- 到达站站名 -->
                        <TextBlock Text="{Binding ArriveStationWithSpacing}" 
                                FontWeight="Bold" 
                                Foreground="Black"
                                FontFamily="SimHei" 
                                FontSize="40"
                                Width="280"
                                Margin="540,60,0,0"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top" />

                        <!-- 到达站拼音 -->
                        <TextBlock Text="{Binding SelectedTicket.ArriveStationPinyin, Converter={StaticResource FirstLetterToUpperConverter}}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontSize="28"
                                FontFamily="Times New Roman"
                                Margin="0,105,0,0"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top">
                            <TextBlock.RenderTransform>
                                <TranslateTransform X="{Binding ArriveStationPinyinPosition}"/>
                            </TextBlock.RenderTransform>
                        </TextBlock>

                        <!-- 到达站"站"字 -->
                        <TextBlock Text="站" 
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="30"
                                Width="40"
                                Height="40"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top">
                            <TextBlock.Margin>
                                <MultiBinding Converter="{StaticResource StationWordPositionConverter}">
                                    <Binding Path="ArriveStationName"/>
                                    <Binding Source="755,126,25,351"/>
                                </MultiBinding>
                            </TextBlock.Margin>
                        </TextBlock>


                        <!-- 分开的年月日显示 -->
                        <StackPanel Orientation="Horizontal" 
                                  Margin="60,145,0,0" 
                                  HorizontalAlignment="Left" 
                                  VerticalAlignment="Top">
                            <!-- 年份 -->
                            <!-- 年字 -->
                            <!-- 年份 -->
                            <TextBlock Text="{Binding DepartYear}"
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontFamily="Times New Roman"
                                FontSize="32"/>
                            <!-- 年字 -->
                            <TextBlock Text="年" 
                                FontWeight="Bold"
                                FontFamily="SimHei"
                                Foreground="Black"
                                Margin="0,8,0,0"
                                FontSize="18" Height="23"/>
                            <!-- 月份 -->
                            <TextBlock Text="{Binding DepartMonth}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontFamily="Times New Roman"
                                FontSize="32"/>
                            <!-- 月字 -->
                            <TextBlock Text="月"
                                Margin="0,8,0,0"
                                FontFamily="SimHei"
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="18" Height="23"/>
                            <!-- 日 -->
                            <TextBlock Text="{Binding DepartDay}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontFamily="Times New Roman"
                                FontSize="32"/>
                            <!-- 日字 -->
                            <TextBlock Text="日"
                                Margin="0,8,0,0"
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="18" Height="23"/>
                        </StackPanel>

                        <!-- 出发时间 - 根据截图最终调整位置 -->
                        <TextBlock Text="{Binding DepartTimeFormatted}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontSize="32"
                                FontFamily="Times New Roman"
                                Margin="280,145,0,0" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>
                        <!-- "开"字 -->
                        <TextBlock Text="开" 
                         FontWeight="Bold" 
                                Foreground="Black"
                                FontFamily="SimHei"
                                FontSize="18" 
                                Margin="358,155,0,0" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- 车厢号和座位号 -->
                        <!-- 车厢号-->
                        <TextBlock Text="{Binding CoachNumber}" 
                                FontWeight="Normal" 
                                Foreground="Black"
                                FontFamily="Times New Roman"
                                FontSize="32" 
                                Margin="534,145,0,0" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- "车"字 -->
                        <TextBlock Text="车" 
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="18" 
                                Margin="571,155,0,0"
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- "加"字 - 条件显示 -->
                        <TextBlock Text="加" 
                                FontWeight="Bold"
                                FontFamily="SimHei"
                                Foreground="Black" 
                                FontSize="18" 
                                Margin="510,155,0,0"
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasAddedCoach}" Value="False">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 普通座位号显示 -->
                        <TextBlock Text="{Binding SelectedTicket.SeatNo}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontSize="32"
                                FontFamily="Times New Roman"
                                Margin="597,145,0,0" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasNoSeat}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- "无座"显示 -->
                        <StackPanel Orientation="Horizontal" 
                                  Margin="600,150,0,0" 
                                  HorizontalAlignment="Left" 
                                  VerticalAlignment="Top">
                            <TextBlock Text="无" 
                                    FontWeight="Medium" 
                                    Foreground="Black" 
                                    FontSize="28"
                                    FontFamily="SimSun-ExtG">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasNoSeat}" Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Text="座" 
                                    FontWeight="Medium" 
                                    Foreground="Black" 
                                    FontSize="28"
                                    FontFamily="SimSun-ExtG"
                                    Margin="-2,0,0,0">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasNoSeat}" Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>

                        <!-- "号"字 -->
                        <TextBlock Text="号" 
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="18" 
                                Margin="654,155,0,0"
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasNoSeat}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 金额 -->
                        <!-- 人民币符号 -->
                        <TextBlock Text="¥" 
                                FontWeight="Medium" 
                                Foreground="Black" 
                                FontSize="28" 
                                Margin="55,185,0,0" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- 金额数值 -->
                        <TextBlock Text="{Binding MoneyValue}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontFamily="Times New Roman"
                                FontSize="32" 
                                d:Text="9999.99"
                                Margin="74,185,0,0" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"
                                Name="moneyValueText"/>

                        <!-- 金额：元-->
                        <TextBlock Text="元" 
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="16"
                                Width="16"
                                Height="22"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top">
                            <TextBlock.Margin>
                                <MultiBinding Converter="{StaticResource MoneyUnitPositionConverter}">
                                    <Binding Path="MoneyValue"/>
                                    <Binding Source="178,280,0,0"/>
                                </MultiBinding>
                            </TextBlock.Margin>
                        </TextBlock>

                        <!-- 座位类型 -->
                        <TextBlock Text="{Binding SelectedTicket.SeatType}" 
                                FontWeight="Bold"
                                FontFamily="SimHei"
                                Foreground="Black"
                                FontSize="24" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Margin" Value="600,195,0,0"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasNoSeat}" Value="True">
                                            <Setter Property="Margin" Value="530,190,0,0"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 附加信息 - 条件显示 -->
                        <TextBlock Text="{Binding SelectedTicket.AdditionalInfo}" 
                                FontWeight="SemiBold" 
                                Foreground="Black" 
                                FontSize="24"
                                   FontFamily="SimHei"
                                Margin="55,260,0,0" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedTicket.AdditionalInfo, Converter={StaticResource StringToVisibilityConverter}}" Value="Collapsed">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 车票用途 - 条件显示 -->
                        <TextBlock Text="{Binding SelectedTicket.TicketPurpose}" 
                                FontWeight="SemiBold" 
                                Foreground="Black" 
                                FontSize="24"
                                FontFamily="SimHei"
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Setter Property="Margin" Value="54,320,0,0"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedTicket.TicketPurpose, Converter={StaticResource StringToVisibilityConverter}}" Value="Collapsed">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                        <!-- 如果车票改签类型有值，将车票用途向右移动 -->
                                        <DataTrigger Binding="{Binding SelectedTicket.TicketModificationType, Converter={StaticResource StringToVisibilityConverter}}" Value="Visible">
                                            <Setter Property="Margin" Value="180,320,0,0"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 车票改签类型 - 条件显示 -->
                        <TextBlock Text="{Binding SelectedTicket.TicketModificationType}" 
                                FontWeight="SemiBold" 
                                Foreground="Black" 
                                FontSize="24"
                                FontFamily="SimHei"
                                Margin="54,320,0,0" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <!-- 如果车票改签类型为空，不显示 -->
                                        <DataTrigger Binding="{Binding SelectedTicket.TicketModificationType, Converter={StaticResource StringToVisibilityConverter}}" Value="Collapsed">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 身份信息 -->
                        <TextBlock Text="{Binding IdentityInfo}" 
                                FontWeight="Normal" 
                                Foreground="Black"
                                FontFamily="SimSun-ExtB"
                                FontSize="32" 
                                Margin="60,354,0,0" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- 编码区 -->
                        <TextBlock Text="{Binding EncodingArea}" 
                                FontWeight="Normal"
                                FontFamily="Times New Roman"
                                Foreground="Black" 
                                FontSize="28" 
                                Margin="44,467,0,0" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- 提示信息框 - 调整为虚线框 -->
                        <Border BorderThickness="1"
                                Width="485"
                                Height="60"
                                Margin="-170,390,0,0" 
                                HorizontalAlignment="Center"
                                VerticalAlignment="Top"
                                Background="Transparent">
                            <Border.BorderBrush>
                                <VisualBrush>
                                    <VisualBrush.Visual>
                                        <Rectangle StrokeDashArray="4 2"
                                                 Stroke="Black"
                                                 StrokeThickness="1"
                                                 Width="{Binding RelativeSource={RelativeSource AncestorType={x:Type Border}}, Path=ActualWidth}"
                                                 Height="{Binding RelativeSource={RelativeSource AncestorType={x:Type Border}}, Path=ActualHeight}"/>
                                    </VisualBrush.Visual>
                                </VisualBrush>
                            </Border.BorderBrush>
                            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <ItemsControl ItemsSource="{Binding HintLines}" RenderTransformOrigin="0.5,0.5" 
                                              VerticalAlignment="Center">
                                    <ItemsControl.RenderTransform>
                                        <TransformGroup>
                                            <ScaleTransform/>
                                            <SkewTransform AngleY="0.117"/>
                                            <RotateTransform/>
                                            <TranslateTransform Y="-0.495"/>
                                        </TransformGroup>
                                    </ItemsControl.RenderTransform>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}" 
                                                    FontSize="20"
                                                    FontFamily="SimHei"
                                                    FontWeight="Medium"
                                                    HorizontalAlignment="Center"
                                                    Margin="5,2" 
                                                    TextWrapping="Wrap"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>

                        <!-- 二维码显示 -->
                        <Image Source="{Binding QrCodeImage}" 
                               Width="120" 
                               Height="120" 
                               HorizontalAlignment="Right" 
                               VerticalAlignment="Bottom" 
                               Margin="0,0,50,80"/>
                    </Grid>
                </Viewbox>
            </Grid>

            <!-- 底部按钮 -->
            <StackPanel Grid.Row="1" 
                      Orientation="Horizontal" 
                      HorizontalAlignment="Right" 
                      Margin="0,8,0,0">
                <Button Content="导出图片" 
                        Command="{Binding ExportImageCommand}" 
                        Style="{StaticResource MaterialDesignFlatButton}" 
                        Width="100"
                        Height="36"
                        Margin="0,0,8,0"
                        Foreground="{DynamicResource PrimaryHueMidBrush}"
                        FontFamily="Microsoft YaHei UI"/>
                <Button Content="关闭" 
                        Command="{Binding CloseCommand}" 
                        Style="{StaticResource MaterialDesignFlatButton}" 
                        Width="100"
                        Height="36"
                        Foreground="{DynamicResource PrimaryHueMidBrush}"
                        FontFamily="Microsoft YaHei UI"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window> 