<Window x:Class="TA_WPF.Views.TicketPreviewWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TA_WPF.Views"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:viewmodels="clr-namespace:TA_WPF.ViewModels"
        xmlns:converters="clr-namespace:TA_WPF.Converters"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        d:DataContext="{d:DesignInstance Type=viewmodels:TicketPreviewViewModel, IsDesignTimeCreatable=True}"
        d:DesignHeight="1080" d:DesignWidth="1100"
        mc:Ignorable="d"
        Title="车票预览" 
        Height="700" 
        Width="1100"
        MinHeight="650"
        MinWidth="1000"
        WindowStartupLocation="CenterScreen"
        TextElement.Foreground="{Binding FormForegroundBrush}"
        Background="{Binding FormBackgroundBrush}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="{Binding FontSize}"
        FontFamily="Microsoft YaHei UI">

    <Window.Resources>
        <converters:StationWordPositionConverter x:Key="StationWordPositionConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <converters:MoneyUnitPositionConverter x:Key="MoneyUnitPositionConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:FirstLetterToUpperConverter x:Key="FirstLetterToUpperConverter"/>
        <converters:InverseStringToVisibilityConverter x:Key="InverseStringToVisibilityConverter"/>
        <converters:MoneyValueToMarginConverter x:Key="MoneyValueToMarginConverter"/>
        <converters:TrainNumberPositionConverter x:Key="TrainNumberPositionConverter"/>
        <converters:ArrowStyleConverter x:Key="ArrowStyleConverter"/>
        <converters:PointConverter x:Key="PointConverter"/>
        <converters:ArrowStartPointConverter x:Key="ArrowStartPointConverter"/>
        <converters:HeadStartPointConverter x:Key="HeadStartPointConverter"/>
        <converters:ArrowPathConverter x:Key="ArrowPathConverter"/>
        <converters:StationNameConverter x:Key="StationNameConverter"/>
        <converters:BooleanToThemeConverter x:Key="BooleanToThemeConverter"/>
        <converters:BooleanToVisibilityHiddenConverter x:Key="BooleanToVisibilityHiddenConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <converters:StringEqualityToBooleanConverter x:Key="StringEqualityToBooleanConverter"/>
        <converters:FullScreenWindowStyleConverter x:Key="FullScreenWindowStyleConverter"/>
        <converters:FullScreenWindowStateConverter x:Key="FullScreenWindowStateConverter"/>
        <converters:BooleanToStringConverter x:Key="BooleanToStringConverter"/>
        <converters:FontSizeIncreaseConverter x:Key="FontSizeIncreaseConverter"/>
        <converters:TicketTypeFlagsConverter x:Key="TicketTypeFlagsConverter"/>
        <converters:PaymentChannelFlagsConverter x:Key="PaymentChannelFlagsConverter"/>

        <!-- 自定义表单文本块样式 -->
        <Style x:Key="FormLabelStyle" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignCaptionTextBlock}">
            <Setter Property="FontFamily" Value="Microsoft YaHei UI"/>
            <Setter Property="Margin" Value="2,4,2,2"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="{Binding SmallFontSize}"/>
            <Setter Property="Foreground" Value="{Binding FormForegroundBrush}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding FontSize, Converter={StaticResource FontSizeIncreaseConverter}, ConverterParameter=16}" Value="True">
                    <Setter Property="TextWrapping" Value="Wrap"/>
                    <Setter Property="Margin" Value="2,8,2,4"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- 自定义表单文本框样式 -->
        <Style x:Key="FormTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Setter Property="FontFamily" Value="Microsoft YaHei UI"/>
            <Setter Property="IsEnabled" Value="False"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="8,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Margin" Value="2,0,2,8"/>
            <Setter Property="FontSize" Value="{Binding MediumFontSize}"/>
            <Setter Property="Background" Value="{Binding FormInputBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{Binding FormForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{Binding FormBorderBrush}"/>
        </Style>

        <!-- 系统常量 -->
        <sys:Double x:Key="Ten">10</sys:Double>
        <sys:Double x:Key="Twenty">20</sys:Double>

        <!-- 圆形框样式 - 蓝色车票 -->
        <Style x:Key="TicketTypeCircleBoxStyle" TargetType="Border">
            <Setter Property="Width" Value="30"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="CornerRadius" Value="15"/>
            <Setter Property="BorderThickness" Value="1.5"/>
            <Setter Property="BorderBrush" Value="Black"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
        </Style>

        <!-- 方形框样式 - 红色车票 -->
        <Style x:Key="TicketTypeSquareBoxStyle" TargetType="Border">
            <Setter Property="Width" Value="30"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="CornerRadius" Value="3"/>
            <Setter Property="BorderThickness" Value="1.5"/>
            <Setter Property="BorderBrush" Value="Black"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
        </Style>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="380" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- 左侧数据表单 -->
        <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto" Margin="0,0,12,0">
            <Grid Margin="2,0,2,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="10" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <!-- 0: 标题 -->
                    <RowDefinition Height="Auto" />
                    <!-- 1: 车票号码/检票口 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 2: 车票号码/检票口 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 3: 出发车站/车次号 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 4: 出发车站/车次号 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 5: 出发站拼音/到达车站 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 6: 出发站拼音/到达车站 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 7: 出发日期/到达站拼音 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 8: 出发日期/到达站拼音 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 9: 车厢号/出发时间 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 10: 车厢号/出发时间 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 11: 金额/座位号 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 12: 金额/座位号 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 13: 附加信息/座位类型 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 14: 附加信息/座位类型 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 15: 车票改签类型/车票用途 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 16: 车票改签类型/车票用途 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 17: 票种信息 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 18: 票种信息 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 19: 票种显示选项 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 20: 票种显示选项 控件 -->
                    <RowDefinition Height="Auto" />
                    <!-- 21: 支付渠道 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 22: 支付渠道 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 23: 提示 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 24: 提示 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 25: 身份信息 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 26: 身份信息 文本框 -->
                    <RowDefinition Height="Auto" />
                    <!-- 27: 编码区 标签 -->
                    <RowDefinition Height="Auto" />
                    <!-- 28: 编码区 文本框 -->
                </Grid.RowDefinitions>

                <!-- 标题 - 跨所有列 -->
                <TextBlock Text="车票信息" 
                          Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3"
                          Style="{StaticResource MaterialDesignHeadline6TextBlock}" 
                          Margin="0,0,0,8"
                          FontSize="{Binding HeaderFontSize}"
                          Foreground="{Binding FormForegroundBrush}"
                          FontFamily="Microsoft YaHei UI"/>

                <!-- 第一列 -->
                <!-- 车票号码 -->
                <TextBlock Text="车票号码" Grid.Row="1" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.TicketNumber, Mode=OneWay}" 
                        Grid.Row="2" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 出发车站 -->
                <TextBlock Text="出发车站" Grid.Row="3" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.DepartStation, Mode=OneWay}" 
                        Grid.Row="4" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 出发站拼音 -->
                <TextBlock Text="出发站拼音" Grid.Row="5" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.DepartStationPinyin, Mode=OneWay}" 
                        Grid.Row="6" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 出发日期 -->
                <TextBlock Text="出发日期" Grid.Row="7" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.DepartDate, StringFormat=\{0:yyyy-MM-dd\}, Mode=OneWay}" 
                        Grid.Row="8" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 车厢号 -->
                <TextBlock Text="车厢号" Grid.Row="9" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.CoachNo, Mode=OneWay}" 
                        Grid.Row="10" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 金额 -->
                <TextBlock Text="金额" Grid.Row="11" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.Money, StringFormat=¥\{0:N2\}, Mode=OneWay}" 
                        Grid.Row="12" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 附加信息 -->
                <TextBlock Text="附加信息" Grid.Row="13" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.AdditionalInfo, Mode=OneWay}" 
                        Grid.Row="14" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 车票改签类型 -->
                <TextBlock Text="车票改签类型" Grid.Row="15" Grid.Column="0" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.TicketModificationType, Mode=OneWay}" 
                        Grid.Row="16" Grid.Column="0"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 第二列 -->
                <!-- 检票口 -->
                <TextBlock Text="检票口" Grid.Row="1" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.CheckInLocation, Mode=OneWay}" 
                        Grid.Row="2" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 车次号 -->
                <TextBlock Text="车次号" Grid.Row="3" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.TrainNo, Mode=OneWay}" 
                        Grid.Row="4" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 到达车站 -->
                <TextBlock Text="到达车站" Grid.Row="5" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.ArriveStation, Mode=OneWay}" 
                        Grid.Row="6" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 到达站拼音 -->
                <TextBlock Text="到达站拼音" Grid.Row="7" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.ArriveStationPinyin, Mode=OneWay}" 
                        Grid.Row="8" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 出发时间 -->
                <TextBlock Text="出发时间" Grid.Row="9" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding DepartTimeFormatted, Mode=OneWay}" 
                        Grid.Row="10" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 座位号 -->
                <TextBlock Text="座位号" Grid.Row="11" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.SeatNo, Mode=OneWay}" 
                        Grid.Row="12" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 座位类型 -->
                <TextBlock Text="座位类型" Grid.Row="13" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.SeatType, Mode=OneWay}" 
                        Grid.Row="14" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 车票用途 -->
                <TextBlock Text="车票用途" Grid.Row="15" Grid.Column="2" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.TicketPurpose, Mode=OneWay}" 
                        Grid.Row="16" Grid.Column="2"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 票种信息 - 跨所有列 -->
                <TextBlock Text="票种信息" 
                           Grid.Row="17" Grid.Column="0" 
                           Grid.ColumnSpan="3"
                           Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.TicketTypeFlags, Converter={StaticResource TicketTypeFlagsConverter}}" 
                        Grid.Row="18" Grid.Column="0" Grid.ColumnSpan="3"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 支付渠道 - 跨所有列 -->
                <TextBlock Text="支付渠道" 
                           Grid.Row="19" Grid.Column="0" 
                           Grid.ColumnSpan="3"
                           Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding SelectedTicket.PaymentChannelFlags, Converter={StaticResource PaymentChannelFlagsConverter}}" 
                        Grid.Row="20" Grid.Column="0" Grid.ColumnSpan="3"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 票种信息与支付渠道显示选项 - 新增部分 -->
                <TextBlock Text="票种信息与支付渠道显示选项" 
                           Grid.Row="21" Grid.Column="0" 
                           Grid.ColumnSpan="3"
                           Style="{StaticResource FormLabelStyle}"/>
                <Grid Grid.Row="22" Grid.Column="0" Grid.ColumnSpan="3" Margin="2,0,2,8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <WrapPanel Grid.Row="0" Margin="8,4,0,4">
                        <CheckBox Content="学生票" 
                                  IsChecked="{Binding ShowStudentTicket, Mode=TwoWay}" 
                                  IsEnabled="{Binding IsTicketTypeOptionsLocked, Converter={StaticResource InverseBooleanConverter}}"
                                  Margin="0,0,10,0"/>
                        <CheckBox Content="优惠票" 
                                  IsChecked="{Binding ShowDiscountTicket, Mode=TwoWay}" 
                                  IsEnabled="{Binding IsTicketTypeOptionsLocked, Converter={StaticResource InverseBooleanConverter}}"
                                  Margin="0,0,10,0"/>
                        <CheckBox Content="网络售票" 
                                  IsChecked="{Binding ShowOnlineTicket, Mode=TwoWay}" 
                                  IsEnabled="{Binding IsTicketTypeOptionsLocked, Converter={StaticResource InverseBooleanConverter}}"
                                  Margin="0,0,10,0"/>
                        <CheckBox Content="儿童票" 
                                  IsChecked="{Binding ShowChildTicket, Mode=TwoWay}" 
                                  IsEnabled="{Binding IsTicketTypeOptionsLocked, Converter={StaticResource InverseBooleanConverter}}"
                                  Margin="0,0,10,0"/>
                    </WrapPanel>
                    <CheckBox Grid.Row="1" Content="使用'折'字替代'惠'字" 
                              IsChecked="{Binding UseDiscountAsDiscount, Mode=TwoWay}" 
                              Margin="8,0,0,4"/>
                    <CheckBox Grid.Row="2" Content="显示带框票种信息与支付渠道信息" 
                              IsChecked="{Binding ShowBoxedTicketType, Mode=TwoWay}" 
                              Margin="8,0,0,4"/>
                </Grid>

                <!-- 提示 - 跨所有列 -->
                <TextBlock Text="提示信息" 
                           Grid.Row="23" Grid.Column="0" 
                           Grid.ColumnSpan="3"
                           Style="{StaticResource FormLabelStyle}">
                    <TextBlock.ToolTip>
                        <ToolTip Content="虚线框内的文本内容" />
                    </TextBlock.ToolTip>
                </TextBlock>
                <TextBox Text="{Binding SelectedTicket.Hint, Mode=OneWay}" 
                        Grid.Row="24" Grid.Column="0" Grid.ColumnSpan="3"
                        Style="{StaticResource FormTextBoxStyle}"/>

                <!-- 身份信息 - 移到提示和编码之间，调整行号 -->
                <TextBlock Text="身份信息" Grid.Row="25" Grid.Column="0" Grid.ColumnSpan="3" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding IdentityInfo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                        Grid.Row="26" Grid.Column="0" Grid.ColumnSpan="3"
                        Style="{StaticResource FormTextBoxStyle}"
                        IsEnabled="True"/>

                <!-- 编码区 - 跨所有列，调整行号 -->
                <TextBlock Text="编码区" Grid.Row="27" Grid.Column="0" Grid.ColumnSpan="3" Style="{StaticResource FormLabelStyle}"/>
                <TextBox Text="{Binding EncodingArea, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                        Grid.Row="28" Grid.Column="0" Grid.ColumnSpan="3"
                        Style="{StaticResource FormTextBoxStyle}"
                        IsEnabled="True"/>
            </Grid>
        </ScrollViewer>

        <!-- 右侧车票预览 -->
        <Grid Grid.Column="1" Background="{Binding FormBackgroundBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 车票预览区域 -->
            <Grid Grid.Row="0">
                <Viewbox Stretch="Uniform" Margin="5">
                    <Grid x:Name="PreviewGrid" Width="811" Height="509">
                        <!-- 车票区域内所有TextBlock的默认样式 -->
                        <Grid.Resources>
                            <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                <Setter Property="Foreground" Value="Black" />
                            </Style>
                        </Grid.Resources>

                        <!-- 车票背景，根据主题切换深色/浅色 -->
                        <Image Source="{Binding TicketBackgroundSource}" Stretch="Fill">
                            <!-- 根据主题切换不透明度 -->
                            <Image.Style>
                                <Style TargetType="Image">
                                    <Setter Property="Opacity" Value="1.0"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsDarkMode}" Value="True">
                                            <Setter Property="Opacity" Value="0.9"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Image.Style>
                        </Image>

                        <!-- 车票号码 -->
                        <TextBlock Text="{Binding SelectedTicket.TicketNumber}" 
                                FontWeight="Normal" 
                                Foreground="Red" 
                                FontSize="40" 
                                Margin="{Binding TicketNumberMargin}" 
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top"
                                Name="ticketNumberText">
                            <!-- 确保车票号码始终为红色 -->
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Foreground" Value="Red" />
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <!-- 检票口 - 条件显示 -->
                        <StackPanel Orientation="Horizontal" 
                        Margin="{Binding CheckInLocationMargin}" 
                        HorizontalAlignment="Left" 
                        VerticalAlignment="Top">
                            <TextBlock Text="检票：" 
                            FontWeight="Bold" 
                            Foreground="Black"
                            FontFamily="SimHei"
                            FontSize="28">
                                <TextBlock.Style>
                                    <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="{x:Null}">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="Null">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="null">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="NULL">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Text="{Binding SelectedTicket.CheckInLocation}" 
                                        FontWeight="Bold"
                                       FontFamily="SimHei"
                                        Foreground="Black" 
                                        FontSize="28">
                                <TextBlock.Style>
                                    <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource {x:Type TextBlock}}">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="{x:Null}">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="Null">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="null">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="NULL">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SelectedTicket.CheckInLocation}" Value="">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                        <!-- 出发站站名 -->
                        <TextBlock Text="{Binding DepartStationWithSpacing}" 
                                FontWeight="Bold"
                                FontFamily="SimHei" 
                                Foreground="Black" 
                                FontSize="40" 
                                Margin="{Binding DepartStationMargin}"
                                Width="280"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top" />

                        <!-- 出发站拼音 -->
                        <TextBlock Text="{Binding SelectedTicket.DepartStationPinyin, Converter={StaticResource FirstLetterToUpperConverter}}" 
                                FontWeight="Normal" 
                                Foreground="Black"
                                FontFamily="Times New Roman"
                                FontSize="28" 
                                Margin="{Binding DepartStationPinyinBaseMargin}"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top">
                            <TextBlock.RenderTransform>
                                <TranslateTransform X="{Binding DepartStationPinyinPosition}"/>
                            </TextBlock.RenderTransform>
                        </TextBlock>

                        <!-- 出发站"站"字 -->
                        <TextBlock Text="站" 
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="30"
                                Width="40"
                                Height="40"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top">
                            <TextBlock.Margin>
                                <MultiBinding Converter="{StaticResource StationWordPositionConverter}">
                                    <Binding Path="DepartStationName"/>
                                    <Binding Path="DepartStationWordParam"/>
                                </MultiBinding>
                            </TextBlock.Margin>
                        </TextBlock>

                        <!-- 车次号 -->
                        <TextBlock x:Name="TrainNumber"
                                Text="{Binding SelectedTicket.TrainNo}" 
                                FontWeight="Regular" 
                                Foreground="Black" 
                                FontSize="36"
                                FontFamily="Times New Roman"
                                VerticalAlignment="Top"
                                HorizontalAlignment="Left"
                                Margin="{Binding TrainNumberMargin}">
                        </TextBlock>

                        <!-- 车次号下方箭头 -->
                        <Path Stroke="Black" 
                              StrokeThickness="2.5"
                              HorizontalAlignment="Left"
                              VerticalAlignment="Top"
                              Height="9"
                              Margin="{Binding TrainArrowMargin}"
                              RenderTransformOrigin="0,0">
                            <Path.RenderTransform>
                                <TranslateTransform X="{Binding Margin.Left, ElementName=TrainNumber}"/>
                            </Path.RenderTransform>
                            <Path.Data>
                                <MultiBinding Converter="{StaticResource ArrowPathConverter}">
                                    <Binding Path="ActualWidth" ElementName="TrainNumber"/>
                                    <Binding Path="SelectedTicket.TrainNo"/>
                                    <Binding Path="TrainNumberCenterPosition"/>
                                </MultiBinding>
                            </Path.Data>
                        </Path>

                        <!-- 到达站站名 -->
                        <TextBlock Text="{Binding ArriveStationWithSpacing}" 
                                FontWeight="Bold" 
                                Foreground="Black"
                                FontFamily="SimHei" 
                                FontSize="40"
                                Width="280"
                                Margin="{Binding ArriveStationMargin}"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top" />

                        <!-- 到达站拼音 -->
                        <TextBlock Text="{Binding SelectedTicket.ArriveStationPinyin, Converter={StaticResource FirstLetterToUpperConverter}}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontSize="28"
                                FontFamily="Times New Roman"
                                Margin="{Binding ArriveStationPinyinBaseMargin}"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top">
                            <TextBlock.RenderTransform>
                                <TranslateTransform X="{Binding ArriveStationPinyinPosition}"/>
                            </TextBlock.RenderTransform>
                        </TextBlock>

                        <!-- 到达站"站"字 -->
                        <TextBlock Text="站" 
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="30"
                                Width="40"
                                Height="40"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top">
                            <TextBlock.Margin>
                                <MultiBinding Converter="{StaticResource StationWordPositionConverter}">
                                    <Binding Path="ArriveStationName"/>
                                    <Binding Path="ArriveStationWordParam"/>
                                </MultiBinding>
                            </TextBlock.Margin>
                        </TextBlock>


                        <!-- 分开的年月日显示 -->
                        <StackPanel Orientation="Horizontal" 
                                  Margin="{Binding DateDisplayMargin}" 
                                  HorizontalAlignment="Left" 
                                  VerticalAlignment="Top">
                            <!-- 年份 -->
                            <!-- 年字 -->
                            <!-- 年份 -->
                            <TextBlock Text="{Binding DepartYear}"
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontFamily="Times New Roman"
                                FontSize="32"/>
                            <!-- 年字 -->
                            <TextBlock Text="年" 
                                FontWeight="Bold"
                                FontFamily="SimHei"
                                Foreground="Black" 
                                Margin="0,8,0,0"
                                FontSize="18" Height="23"/>
                            <!-- 月份 -->
                            <TextBlock Text="{Binding DepartMonth}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontFamily="Times New Roman"
                                FontSize="32"/>
                            <!-- 月字 -->
                            <TextBlock Text="月"
                                Margin="0,8,0,0"
                                FontFamily="SimHei"
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="18" Height="23"/>
                            <!-- 日 -->
                            <TextBlock Text="{Binding DepartDay}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontFamily="Times New Roman"
                                FontSize="32"/>
                            <!-- 日字 -->
                            <TextBlock Text="日"
                                Margin="0,8,0,0"
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="18" Height="23"/>
                        </StackPanel>

                        <!-- 出发时间 - 根据截图最终调整位置 -->
                        <TextBlock Text="{Binding DepartTimeFormatted}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontSize="32"
                                FontFamily="Times New Roman"
                                Margin="{Binding DepartTimeMargin}" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>
                        <!-- "开"字 -->
                        <TextBlock Text="开" 
                         FontWeight="Bold" 
                                Foreground="Black"
                                FontFamily="SimHei"
                                FontSize="18" 
                                Margin="{Binding DepartTimeWordMargin}" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- 车厢号和座位号 -->
                        <!-- 车厢号-->
                        <TextBlock Text="{Binding CoachNumber}" 
                                FontWeight="Normal" 
                                Foreground="Black"
                                FontFamily="Times New Roman"
                                FontSize="32" 
                                Margin="{Binding CoachNumberMargin}" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- "车"字 -->
                        <TextBlock Text="车" 
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="18" 
                                Margin="{Binding CoachWordMargin}"
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- "加"字 - 条件显示 -->
                        <TextBlock Text="加" 
                                FontWeight="Bold"
                                FontFamily="SimHei"
                                Foreground="Black" 
                                FontSize="18" 
                                Margin="{Binding AddedCoachWordMargin}"
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasAddedCoach}" Value="False">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 普通座位号显示 -->
                        <TextBlock Text="{Binding SelectedTicket.SeatNo}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontSize="32"
                                FontFamily="Times New Roman"
                                Margin="{Binding SeatNumberMargin}" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasNoSeat}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- "无座"显示 -->
                        <StackPanel Orientation="Horizontal" 
                                  Margin="{Binding NoSeatDisplayMargin}" 
                                  HorizontalAlignment="Left" 
                                  VerticalAlignment="Top">
                            <TextBlock Text="无" 
                                    FontWeight="Medium" 
                                    Foreground="Black" 
                                    FontSize="28"
                                    FontFamily="SimSun-ExtG">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasNoSeat}" Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <TextBlock Text="座" 
                                    FontWeight="Medium" 
                                    Foreground="Black" 
                                    FontSize="28"
                                    FontFamily="SimSun-ExtG"
                                    Margin="-2,0,0,0">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasNoSeat}" Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>

                        <!-- "号"字 -->
                        <TextBlock Text="号" 
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="18" 
                                Margin="{Binding SeatNumberWordMargin}"
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasNoSeat}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 金额 -->
                        <!-- 人民币符号 -->
                        <TextBlock Text="¥" 
                                FontWeight="Medium" 
                                Foreground="Black" 
                                FontSize="28" 
                                Margin="{Binding MoneySymbolMargin}" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- 金额数值 -->
                        <TextBlock Text="{Binding MoneyValue}" 
                                FontWeight="Normal" 
                                Foreground="Black" 
                                FontFamily="Times New Roman"
                                FontSize="32" 
                                d:Text="9999.99"
                                Margin="{Binding MoneyValueMargin}" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"
                                Name="moneyValueText"/>

                        <!-- 金额：元-->
                        <TextBlock Text="元" 
                                FontWeight="Bold" 
                                Foreground="Black" 
                                FontSize="16"
                                Width="16"
                                Height="22"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top">
                            <TextBlock.Margin>
                                <MultiBinding Converter="{StaticResource MoneyUnitPositionConverter}">
                                    <Binding Path="MoneyValue"/>
                                    <Binding Path="MoneyUnitParam"/>
                                </MultiBinding>
                            </TextBlock.Margin>
                        </TextBlock>

                        <!-- 座位类型 -->
                        <TextBlock Text="{Binding SelectedTicket.SeatType}" 
                                FontWeight="Bold"
                                FontFamily="SimHei"
                                Foreground="Black"
                                FontSize="24" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Margin" Value="{Binding SeatTypeMargin}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasNoSeat}" Value="True">
                                            <Setter Property="Margin" Value="{Binding SeatTypeMarginNoSeat}"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 附加信息 - 条件显示 -->
                        <TextBlock Text="{Binding SelectedTicket.AdditionalInfo}" 
                                FontWeight="SemiBold" 
                                Foreground="Black" 
                                FontSize="24"
                                   FontFamily="SimHei"
                                Margin="{Binding AdditionalInfoMargin}" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedTicket.AdditionalInfo, Converter={StaticResource StringToVisibilityConverter}}" Value="Collapsed">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 车票用途 - 条件显示 -->
                        <TextBlock Text="{Binding SelectedTicket.TicketPurpose}" 
                                FontWeight="SemiBold" 
                                Foreground="Black" 
                                FontSize="24"
                                FontFamily="SimHei"
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Setter Property="Margin" Value="{Binding TicketPurposeMargin}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedTicket.TicketPurpose, Converter={StaticResource StringToVisibilityConverter}}" Value="Collapsed">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                        <!-- 如果车票改签类型有值，将车票用途向右移动 -->
                                        <DataTrigger Binding="{Binding SelectedTicket.TicketModificationType, Converter={StaticResource StringToVisibilityConverter}}" Value="Visible">
                                            <Setter Property="Margin" Value="{Binding TicketPurposeWithModMargin}"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 车票改签类型 - 条件显示 -->
                        <TextBlock Text="{Binding SelectedTicket.TicketModificationType}" 
                                FontWeight="SemiBold" 
                                Foreground="Black" 
                                FontSize="24"
                                FontFamily="SimHei"
                                Margin="{Binding TicketModificationTypeMargin}" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <!-- 如果车票改签类型为空，不显示 -->
                                        <DataTrigger Binding="{Binding SelectedTicket.TicketModificationType, Converter={StaticResource StringToVisibilityConverter}}" Value="Collapsed">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- 身份信息 -->
                        <TextBlock Text="{Binding IdentityInfo}" 
                                FontWeight="Normal" 
                                Foreground="Black"
                                FontFamily="SimSun-ExtB"
                                FontSize="32" 
                                Margin="{Binding IdentityInfoMargin}" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- 编码区 -->
                        <TextBlock Text="{Binding EncodingArea}" 
                                FontWeight="Normal"
                                FontFamily="Times New Roman"
                                Foreground="Black" 
                                FontSize="28" 
                                Margin="{Binding EncodingAreaMargin}" 
                                HorizontalAlignment="Left" 
                                VerticalAlignment="Top"/>

                        <!-- 提示信息框 - 调整为虚线框 -->
                        <Border BorderThickness="1"
                                Width="485"
                                Height="60"
                                Margin="{Binding HintBoxMargin}" 
                                HorizontalAlignment="Center"
                                VerticalAlignment="Top"
                                Background="Transparent">
                            <Border.BorderBrush>
                                <VisualBrush>
                                    <VisualBrush.Visual>
                                        <Rectangle StrokeDashArray="4 2"
                                                 Stroke="Black"
                                                 StrokeThickness="1"
                                                 Width="{Binding Path=ActualWidth, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Border}}}"
                                                 Height="{Binding Path=ActualHeight, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Border}}}"/>
                                    </VisualBrush.Visual>
                                </VisualBrush>
                            </Border.BorderBrush>
                            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <ItemsControl ItemsSource="{Binding HintLines}" RenderTransformOrigin="0.5,0.5" 
                                              VerticalAlignment="Center">
                                    <ItemsControl.RenderTransform>
                                        <TransformGroup>
                                            <ScaleTransform/>
                                            <SkewTransform AngleY="0.117"/>
                                            <RotateTransform/>
                                            <TranslateTransform Y="-0.495"/>
                                        </TransformGroup>
                                    </ItemsControl.RenderTransform>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}" 
                                                    FontSize="20"
                                                    FontFamily="SimHei"
                                                    Foreground="Black"
                                                    FontWeight="Medium"
                                                    HorizontalAlignment="Center"
                                                    Margin="5,2" 
                                                    TextWrapping="Wrap"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>

                        <!-- 二维码显示 -->
                        <Image Source="{Binding QrCodeImage}" 
                               Width="120" 
                               Height="120" 
                               HorizontalAlignment="Right" 
                               VerticalAlignment="Bottom" 
                               Margin="{Binding QRCodeMargin}"/>

                        <!-- 票种信息显示 - 学生票 -->
                        <Grid Visibility="{Binding ShowStudentTicket, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="StudentTicketBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding TicketTypeStudentMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding StudentText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding StudentText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding TicketTypeStudentMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>

                        <!-- 票种信息显示 - 优惠票 -->
                        <Grid Visibility="{Binding ShowDiscountTicket, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="DiscountTicketBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding TicketTypeDiscountMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding DiscountText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding DiscountText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding TicketTypeDiscountMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>

                        <!-- 票种信息显示 - 网络售票 -->
                        <Grid Visibility="{Binding ShowOnlineTicket, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="OnlineTicketBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding TicketTypeOnlineMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding OnlineText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding OnlineText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding TicketTypeOnlineMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>

                        <!-- 票种信息显示 - 儿童票 -->
                        <Grid Visibility="{Binding ShowChildTicket, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="ChildTicketBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding TicketTypeChildMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding ChildText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding ChildText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding TicketTypeChildMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>

                        <!-- 支付渠道显示 - 支付宝 -->
                        <Grid Visibility="{Binding ShowAlipayPayment, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="AlipayBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding PaymentAlipayMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding AlipayText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding AlipayText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding PaymentAlipayMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>

                        <!-- 支付渠道显示 - 微信 -->
                        <Grid Visibility="{Binding ShowWeChatPayment, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="WeChatBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding PaymentWeChatMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding WeChatText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding WeChatText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding PaymentWeChatMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>

                        <!-- 支付渠道显示 - 农业银行 -->
                        <Grid Visibility="{Binding ShowABCPayment, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="ABCBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding PaymentABCMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding ABCText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding ABCText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding PaymentABCMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>

                        <!-- 支付渠道显示 - 建设银行 -->
                        <Grid Visibility="{Binding ShowCCBPayment, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="CCBBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding PaymentCCBMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding CCBText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding CCBText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding PaymentCCBMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>

                        <!-- 支付渠道显示 - 工商银行 -->
                        <Grid Visibility="{Binding ShowICBCPayment, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="ICBCBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding PaymentICBCMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding ICBCText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding ICBCText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding PaymentICBCMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>
                        
                        <!-- 支付渠道显示 - 招商银行 -->
                        <Grid Visibility="{Binding ShowCMBPayment, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="CMBBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding PaymentCMBMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding CMBText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding CMBText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding PaymentCMBMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>
                        
                        <!-- 支付渠道显示 - 邮储银行 -->
                        <Grid Visibility="{Binding ShowPSBCPayment, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="PSBCBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding PaymentPSBCMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding PSBCText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding PSBCText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding PaymentPSBCMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>
                        
                        <!-- 支付渠道显示 - 中国银行 -->
                        <Grid Visibility="{Binding ShowBOCPayment, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="BOCBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding PaymentBOCMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding BOCText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding BOCText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding PaymentBOCMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>
                        
                        <!-- 支付渠道显示 - 交通银行 -->
                        <Grid Visibility="{Binding ShowCOMMPayment, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- 带框模式 -->
                            <Border x:Name="COMMBox"
                                    Style="{Binding TicketTypeBoxStyle}" 
                                    Margin="{Binding PaymentCOMMMargin}"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="{Binding COMMText}" 
                                        FontWeight="Bold" 
                                        Foreground="Black" 
                                        FontSize="18"
                                        FontFamily="SimHei"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- 不带框模式 -->
                            <TextBlock Text="{Binding COMMText}" 
                                    FontWeight="Bold" 
                                    Foreground="Black" 
                                    FontSize="24"
                                    FontFamily="SimHei"
                                    Margin="{Binding PaymentCOMMMargin}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Visibility="{Binding ShowBoxedTicketType, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                        </Grid>
                    </Grid>
                </Viewbox>
            </Grid>

            <!-- 底部按钮 -->
            <StackPanel Grid.Row="1" 
                      Orientation="Horizontal" 
                      HorizontalAlignment="Right" 
                      Margin="0,12,0,8">
                <Button Content="导出图片" 
                        Command="{Binding ExportImageCommand}" 
                        Style="{StaticResource MaterialDesignFlatButton}" 
                        Width="120"
                        Height="45"
                        Margin="0,0,12,0"
                        Foreground="{DynamicResource PrimaryHueMidBrush}"
                        FontSize="{Binding MediumFontSize}"
                        FontFamily="Microsoft YaHei UI"/>
                <Button Content="{Binding ToggleTicketColorButtonText}" 
                        Command="{Binding ToggleTicketColorCommand}" 
                        Style="{StaticResource MaterialDesignFlatButton}" 
                        Width="120"
                        Height="45"
                        Margin="0,0,12,0"
                        Foreground="{DynamicResource PrimaryHueMidBrush}"
                        FontSize="{Binding MediumFontSize}"
                        FontFamily="Microsoft YaHei UI"/>
                <Button Content="关闭" 
                        Command="{Binding CloseCommand}" 
                        Style="{StaticResource MaterialDesignFlatButton}" 
                        Width="120"
                        Height="45"
                        Foreground="{DynamicResource PrimaryHueMidBrush}"
                        FontSize="{Binding MediumFontSize}"
                        FontFamily="Microsoft YaHei UI"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window> 