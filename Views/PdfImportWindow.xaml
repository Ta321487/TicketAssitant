<Window x:Class="TA_WPF.Views.PdfImportWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TA_WPF.Views"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:viewmodels="clr-namespace:TA_WPF.ViewModels"
        xmlns:converters="clr-namespace:TA_WPF.Converters"
        mc:Ignorable="d"
        Title="12306车票PDF导入" Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="{DynamicResource MaterialDesignFontSize}"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="Microsoft YaHei"
        d:DataContext="{d:DesignInstance Type=viewmodels:PdfImportViewModel}">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.Light.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.Defaults.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignColors;component/Themes/Recommended/Primary/MaterialDesignColor.DeepPurple.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignColors;component/Themes/Recommended/Accent/MaterialDesignColor.Lime.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
            
            <!-- 表单标签样式 -->
            <Style x:Key="FormLabelStyle" TargetType="TextBlock">
                <Setter Property="Margin" Value="0,0,8,0"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="FontWeight" Value="Medium"/>
                <Setter Property="FontFamily" Value="Microsoft YaHei"/>
                <Setter Property="FontSize" Value="{DynamicResource MaterialDesignFontSize}"/>
            </Style>
            
            <!-- 滚动条样式 -->
            <Style x:Key="AutoHideScrollViewerStyle" TargetType="ScrollViewer">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ScrollViewer">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <ScrollContentPresenter Grid.Column="0" Grid.Row="0"/>
                                <ScrollBar x:Name="PART_VerticalScrollBar"
                                         Grid.Column="1" Grid.Row="0"
                                         Value="{TemplateBinding VerticalOffset}"
                                         Maximum="{TemplateBinding ScrollableHeight}"
                                         ViewportSize="{TemplateBinding ViewportHeight}"
                                         Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"/>
                                <ScrollBar x:Name="PART_HorizontalScrollBar"
                                         Grid.Column="0" Grid.Row="1"
                                         Orientation="Horizontal"
                                         Value="{TemplateBinding HorizontalOffset}"
                                         Maximum="{TemplateBinding ScrollableWidth}"
                                         ViewportSize="{TemplateBinding ViewportWidth}"
                                         Visibility="{TemplateBinding ComputedHorizontalScrollBarVisibility}"/>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <materialDesign:DialogHost Identifier="PdfImportDialogHost">
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 标题 -->
            <TextBlock Grid.Row="0" 
                       Text="从12306导入电子客票" 
                       Style="{StaticResource MaterialDesignHeadline5TextBlock}" 
                       Margin="0,0,0,16"/>

            <!-- 内容区域 -->
            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 文件选择区域 -->
                <Grid Grid.Row="0" Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0"
                            Text="{Binding SelectedPdfPath}"
                            materialDesign:HintAssist.Hint="选择12306电子客票PDF文件"
                            Style="{StaticResource MaterialDesignOutlinedTextBox}"
                            VerticalAlignment="Center"
                            IsReadOnly="True"
                            Margin="0,0,8,0"/>

                    <Button Grid.Column="1"
                            Command="{Binding SelectPdfCommand}"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            materialDesign:ButtonAssist.CornerRadius="4"
                            Foreground="{DynamicResource GlobalAccentBrush}"
                            Height="36" 
                            Padding="8,4"
                            VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="FileFind" Height="20" Width="20" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <TextBlock Text="浏览..." VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </Grid>

                <!-- PDF内容预览区域 -->
                <Border Grid.Row="1" 
                        BorderBrush="{DynamicResource MaterialDesignDivider}" 
                        BorderThickness="1"
                        CornerRadius="4"
                        Margin="0,0,0,16">
                    <Grid>
                        <!-- 加载指示器 -->
                        <Grid Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                              HorizontalAlignment="Center" 
                              VerticalAlignment="Center">
                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                            Value="0"
                                            IsIndeterminate="True"
                                            HorizontalAlignment="Center"
                                            Margin="0,0,0,8"/>
                                <TextBlock Text="正在读取PDF内容..." 
                                           HorizontalAlignment="Center"
                                           Style="{StaticResource MaterialDesignBody1TextBlock}"/>
                            </StackPanel>
                        </Grid>
                            
                        <!-- PDF内容 -->
                        <ScrollViewer VerticalScrollBarVisibility="Auto" 
                                      HorizontalScrollBarVisibility="Auto"
                                      Style="{StaticResource AutoHideScrollViewerStyle}"
                                      Visibility="{Binding IsLoading, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                            <TextBlock Text="{Binding PdfContent}"
                                      FontFamily="Consolas, Courier New, monospace"
                                      TextWrapping="NoWrap"
                                      Style="{StaticResource MaterialDesignBody1TextBlock}"
                                      Padding="16"/>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>

            <!-- 按钮区域 -->
            <StackPanel Grid.Row="2" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Right" 
                        Margin="0,0,0,0">
                <Button Content="取消" 
                        Command="{Binding CancelCommand}" 
                        Style="{StaticResource MaterialDesignFlatButton}" 
                        materialDesign:ButtonAssist.CornerRadius="4"
                        Foreground="{DynamicResource GlobalAccentBrush}"
                        Margin="0,0,16,0"
                        Height="48"
                        MinHeight="36"
                        FontSize="{DynamicResource MaterialDesignFontSize}"
                        Padding="16,8"/>
                        
                <Button Command="{Binding ImportTicketCommand}"
                        IsEnabled="{Binding HasSelectedPdf}"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        materialDesign:ButtonAssist.CornerRadius="4"
                        Foreground="{DynamicResource GlobalAccentBrush}"
                        Height="48"
                        MinHeight="36"
                        FontSize="{DynamicResource MaterialDesignFontSize}"
                        Padding="16,8"
                        IsDefault="True">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Import" Margin="0,0,4,0" VerticalAlignment="Center"/>
                        <TextBlock Text="导入车票" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>
    </materialDesign:DialogHost>
</Window> 